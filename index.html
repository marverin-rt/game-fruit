<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catch the Fruit Game</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="gameContainer">

    <div id="scoreBoard">
        Score: <span id="score">0</span>
    </div>

    <!-- Basket image -->
    <img src="images/basket.webp" id="basket" />

    <!-- START SCREEN -->
    <div id="startScreen">
        <div>üçá Catch The Fruits!</div>
        <button class="btn" id="startBtn">START GAME</button>
    </div>

    <!-- GAME OVER SCREEN -->
    <div id="gameOverScreen" style="display:none;">
        <div id="finalScore">Score: 0</div>
        <button class="btn" id="playAgainBtn">PLAY AGAIN</button>
    </div>

</div>

<script>
const container = document.getElementById("gameContainer");
const basket = document.getElementById("basket");
const scoreText = document.getElementById("score");

const startScreen = document.getElementById("startScreen");
const gameOverScreen = document.getElementById("gameOverScreen");
const startBtn = document.getElementById("startBtn");
const playAgainBtn = document.getElementById("playAgainBtn");

let score = 0;
let basketX = 160;
let gameActive = false;
let fallSpeedBoost = 0;

// Keyboard movement
document.body.addEventListener("keydown", (e) => {
    if (!gameActive) return;
    if (e.key === "ArrowLeft" && basketX > 0) basketX -= 20;
    if (e.key === "ArrowRight" && basketX < 320) basketX += 20;
    basket.style.left = basketX + "px";
});

function resetGameSession() {
    score = 0;
    fallSpeedBoost = 0;
    basketX = 160;
    basket.style.left = "160px";
    gameActive = false;
    document.querySelectorAll('.fruit, .bomb').forEach(f => f.remove());
    startScreen.style.display = "flex";
    gameOverScreen.style.display = "none";
    scoreText.textContent = score;
}

function startGame() {
    score = 0;
    fallSpeedBoost = 0;
    gameActive = true;
    scoreText.textContent = 0;
    basketX = 160;
    basket.style.left = "160px";
    document.querySelectorAll('.fruit, .bomb').forEach(f => f.remove());
    startScreen.style.display = "none";
    gameOverScreen.style.display = "none";
}

startBtn.onclick = startGame;
playAgainBtn.onclick = startGame;

// Spawn fruits or bombs
function spawnObject() {
    if (!gameActive) return;

    const drop = document.createElement("img");
    const isBomb = Math.random() < 0.12;

    if (isBomb) {
        drop.src = "images/bomb.webp";
        drop.classList.add("bomb");
        drop.dataset.points = -999;
    } else {
        const types = [
            { type: "banana", points: 4, img: "images/banana.webp" },
            { type: "mango", points: 6, img: "images/mango.webp" },
            { type: "apple", points: 2, img: "images/apple.webp" },
            { type: "watermelon", points: 8, img: "images/watermelon.webp" }
        ];
        const chosen = types[Math.floor(Math.random() * types.length)];
        drop.src = chosen.img;
        drop.classList.add("fruit");
        drop.dataset.points = chosen.points;
    }

    drop.style.width = "30px";
    drop.style.height = "30px";
    drop.style.position = "absolute";
    drop.style.top = "-40px";
    drop.style.left = Math.random() * 360 + "px";
    container.appendChild(drop);

    let fallSpeed = 1.5 + fallSpeedBoost;

    let fall = setInterval(() => {
        if (!gameActive) { clearInterval(fall); drop.remove(); return; }
        drop.style.top = drop.offsetTop + fallSpeed + "px";

        // Collision detection
        const basketTop = basket.offsetTop;
        const basketBottom = basket.offsetTop + basket.offsetHeight;
        const basketLeft = basketX;
        const basketRight = basketX + basket.offsetWidth;

        const dropTop = drop.offsetTop;
        const dropBottom = drop.offsetTop + drop.offsetHeight;
        const dropLeft = drop.offsetLeft;
        const dropRight = drop.offsetLeft + drop.offsetWidth;

        if (
            dropBottom >= basketTop &&
            dropTop <= basketBottom &&
            dropRight >= basketLeft &&
            dropLeft <= basketRight
        ) {
            if (drop.classList.contains("bomb")) { 
                endGame(); 
            } else { 
                score += parseInt(drop.dataset.points); 
                scoreText.textContent = score; 
            }
            drop.remove(); 
            clearInterval(fall);
        }

        if (drop.offsetTop > 600) { drop.remove(); clearInterval(fall); }
    }, 20);
}

function endGame() {
    gameActive = false;
    document.getElementById("finalScore").textContent = "Score: " + score;
    gameOverScreen.style.display = "flex";
}

setInterval(() => { if (gameActive) fallSpeedBoost += 0.05; }, 1500);
setInterval(spawnObject, 1000);

// Reset game when user leaves the page
window.addEventListener('beforeunload', resetGameSession);

</script>

</body>
</html>
